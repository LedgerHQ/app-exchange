#include "common_byte_strings.h"
#include "sol/parser.h"
#include "sol/print_config.h"
#include "sol/transaction_summary.h"
#include "message.c"
#include "util.h"
#include <assert.h>
#include <stdio.h>

// Disable clang format for this file to keep clear buffer formatting
/* clang-format off */

void test_process_message_body_ok() {
    Pubkey accounts[] = {
        {{171, 88, 202, 32, 185, 160, 182, 116, 130, 185, 73, 48, 13, 216, 170, 71, 172, 195, 165, 123, 87, 70, 130, 219, 5, 157, 240, 187, 26, 191, 158, 218}},
        {{204, 241, 115, 109, 41, 173, 110, 48, 24, 113, 210, 213, 163, 78, 1, 112, 146, 114, 235, 220, 96, 185, 184, 85, 163, 27, 124, 48, 54, 250, 233, 54}},
        {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
    };
    Blockhash blockhash = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    PrintConfig print_config = { .header = {false, 0, {1, 0, 1, 3}, accounts, &blockhash, 1}, .expert_mode = true };
    uint8_t msg_body[] = {2, 2, 0, 1, 12, 2, 0, 0, 0, 42, 0, 0, 0, 0, 0, 0, 0};

    transaction_summary_reset();
    assert(process_message_body(msg_body, ARRAY_LEN(msg_body), &print_config) == 0);
    transaction_summary_set_fee_payer_pubkey(&print_config.header.pubkeys[0]);
    enum SummaryItemKind kinds[MAX_TRANSACTION_SUMMARY_ITEMS];
    size_t num_kinds;
    assert(transaction_summary_finalize(kinds, &num_kinds) == 0);
    assert(num_kinds == 4);
}

void test_process_message_body_xfer_w_nonce_ok() {
    Pubkey accounts[] = {
        {{171, 88, 202, 32, 185, 160, 182, 116, 130, 185, 73, 48, 13, 216, 170, 71, 172, 195, 165, 123, 87, 70, 130, 219, 5, 157, 240, 187, 26, 191, 158, 218}},
        {{204, 241, 115, 109, 41, 173, 110, 48, 24, 113, 210, 213, 163, 78, 1, 112, 146, 114, 235, 220, 96, 185, 184, 85, 163, 27, 124, 48, 54, 250, 233, 54}},
        {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
    };
    Blockhash blockhash = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    PrintConfig print_config = { .header = {false, 0, {1, 0, 1, 3}, accounts, &blockhash, 2}, .expert_mode = true };
    uint8_t msg_body[] = {
        2, 3, 0, 1, 0, 4, 4, 0, 0, 0, // Nonce
        2, 2, 0, 1, 12, 2, 0, 0, 0, 42, 0, 0, 0, 0, 0, 0, 0
    };
    transaction_summary_reset();
    assert(process_message_body(msg_body, ARRAY_LEN(msg_body), &print_config) == 0);
    transaction_summary_set_fee_payer_pubkey(&print_config.header.pubkeys[0]);
    enum SummaryItemKind kinds[MAX_TRANSACTION_SUMMARY_ITEMS];
    size_t num_kinds;
    assert(transaction_summary_finalize(kinds, &num_kinds) == 0);
    assert(num_kinds == 6);
}

void test_process_message_body_too_few_ix_fail() {
    PrintConfig print_config = { .header = {false, 0, {0, 0, 0, 0}, NULL, NULL, 0}, .expert_mode = true };
    assert(process_message_body(NULL, 0, &print_config) == 1);
}

void test_process_message_body_too_many_ix_fail() {
    Pubkey accounts[] = {
        {{171, 88, 202, 32, 185, 160, 182, 116, 130, 185, 73, 48, 13, 216, 170, 71, 172, 195, 165, 123, 87, 70, 130, 219, 5, 157, 240, 187, 26, 191, 158, 218}},
        {{204, 241, 115, 109, 41, 173, 110, 48, 24, 113, 210, 213, 163, 78, 1, 112, 146, 114, 235, 220, 96, 185, 184, 85, 163, 27, 124, 48, 54, 250, 233, 54}},
        {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
    };
    Blockhash blockhash = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    uint8_t xfer_ix[] = {2, 2, 0, 1, 12, 2, 0, 0, 0, 42, 0, 0, 0, 0, 0, 0, 0};

#define TOO_MANY_IX (MAX_INSTRUCTIONS + 1)
#define XFER_IX_LEN ARRAY_LEN(xfer_ix)

    uint8_t msg_body[TOO_MANY_IX * XFER_IX_LEN];
    for (size_t i = 0; i < TOO_MANY_IX; i++) {
        uint8_t* start = msg_body + (i * XFER_IX_LEN);
        memcpy(start, xfer_ix, XFER_IX_LEN);
    }
    PrintConfig print_config = { .header = {false, 0, {1, 0, 1, 3}, accounts, &blockhash, TOO_MANY_IX}, .expert_mode = true };
    assert(process_message_body(msg_body, ARRAY_LEN(msg_body), &print_config) == 1);
}

void test_process_message_body_data_too_short_fail() {
    PrintConfig print_config = { .header = {false, 0, {0, 0, 0, 0}, NULL, NULL, 1}, .expert_mode = true };
    assert(process_message_body(NULL, 0, &print_config) == 1);
}

void test_process_message_body_data_too_long_fail() {
    Pubkey accounts[] = {
        {{171, 88, 202, 32, 185, 160, 182, 116, 130, 185, 73, 48, 13, 216, 170, 71, 172, 195, 165, 123, 87, 70, 130, 219, 5, 157, 240, 187, 26, 191, 158, 218}},
        {{204, 241, 115, 109, 41, 173, 110, 48, 24, 113, 210, 213, 163, 78, 1, 112, 146, 114, 235, 220, 96, 185, 184, 85, 163, 27, 124, 48, 54, 250, 233, 54}},
        {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
    };
    Blockhash blockhash = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    PrintConfig print_config = { .header = {false, 0, {1, 0, 1, 3}, accounts, &blockhash, 1}, .expert_mode = true };
    uint8_t msg_body[] = {
        2, 2, 0, 1, 12, 2, 0, 0, 0, 42, 0, 0, 0, 0, 0, 0, 0,
        0
    };
    assert(process_message_body(msg_body, ARRAY_LEN(msg_body), &print_config) == 1);
}

void test_process_message_body_bad_ix_account_index_fail() {
    PrintConfig print_config = { .header = {false, 0, {0, 0, 0, 1}, NULL, NULL, 1}, .expert_mode = true };
    uint8_t msg_body[] = {1, 0, 0};
    assert(process_message_body(msg_body, ARRAY_LEN(msg_body), &print_config) == 1);
}

void test_process_message_body_unknown_ix_enum_fail() {
    Pubkey accounts[] = {
        {{171, 88, 202, 32, 185, 160, 182, 116, 130, 185, 73, 48, 13, 216, 170, 71, 172, 195, 165, 123, 87, 70, 130, 219, 5, 157, 240, 187, 26, 191, 158, 218}},
        {{204, 241, 115, 109, 41, 173, 110, 48, 24, 113, 210, 213, 163, 78, 1, 112, 146, 114, 235, 220, 96, 185, 184, 85, 163, 27, 124, 48, 54, 250, 233, 54}},
        {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}},
    };
    Blockhash blockhash = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    PrintConfig print_config = { .header = {false, 0, {1, 0, 1, 3}, accounts, &blockhash, 1}, .expert_mode = true };
    uint8_t msg_body[] = {
        2, 2, 0, 1, 12, 255, 255, 255, 255, 42, 0, 0, 0, 0, 0, 0, 0,
    };
    assert(process_message_body(msg_body, ARRAY_LEN(msg_body), &print_config) == 1);
}

void test_process_message_body_ix_with_unknown_program_id_fail() {
    Pubkey accounts[] = {
        {{171, 88, 202, 32, 185, 160, 182, 116, 130, 185, 73, 48, 13, 216, 170, 71, 172, 195, 165, 123, 87, 70, 130, 219, 5, 157, 240, 187, 26, 191, 158, 218}},
        {{204, 241, 115, 109, 41, 173, 110, 48, 24, 113, 210, 213, 163, 78, 1, 112, 146, 114, 235, 220, 96, 185, 184, 85, 163, 27, 124, 48, 54, 250, 233, 54}},
        {{255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255}},
    };
    Blockhash blockhash = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    PrintConfig print_config = { .header = {false, 0, {1, 0, 1, 3}, accounts, &blockhash, 1}, .expert_mode = true };
    uint8_t msg_body[] = {
        2, 2, 0, 1, 12, 2, 0, 0, 0, 42, 0, 0, 0, 0, 0, 0, 0,
    };
    assert(process_message_body(msg_body, ARRAY_LEN(msg_body), &print_config) == 1);
}

static void process_message_body_and_sanity_check(const uint8_t* message, size_t message_length, size_t expected_fields) {
    PrintConfig print_config;
    print_config.expert_mode = true;
    Parser parser = { message, message_length };
    assert(parse_message_header(&parser, &print_config.header) == 0);
    transaction_summary_reset();
    assert(process_message_body(parser.buffer, parser.buffer_length, &print_config) == 0);
    transaction_summary_set_fee_payer_pubkey(&print_config.header.pubkeys[0]);

    enum SummaryItemKind kinds[MAX_TRANSACTION_SUMMARY_ITEMS];
    size_t num_kinds;
    assert(transaction_summary_finalize(kinds, &num_kinds) == 0);
    assert(num_kinds == expected_fields);
    for (size_t i = 0; i < num_kinds; i++) {
        assert(transaction_summary_display_item(i, DisplayFlagNone) == 0);
    }
}

/**
 * Transfer 6 lamports with compute budget limit instruction
 */
void test_process_message_body_transfer_with_compute_budget_limit(){


    uint8_t message[] = {
    2, 0, 2,
    5, 21, 114, 229, 47, 44, 94, 126, 102, 188, 25, 172, 108, 211, 11, 109, 105, 110, 167, 153, 207, 230, 215, 132, 84, 42, 183, 216, 183, 254, 49, 91, 92, 151, 92, 21, 68, 212, 0, 50, 152, 29, 184, 10, 237, 93, 26, 195, 28, 41, 242, 83, 160, 179, 163, 125, 22, 218, 2, 189, 250, 180, 15, 129, 237, 121, 159, 134, 35, 112, 111, 25, 35, 23, 57, 215, 23, 85, 213, 131, 83, 179, 66, 3, 70, 50, 124, 61, 59, 195, 97, 48, 196, 191, 215, 90, 77, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    3, 6, 70, 111, 229, 33, 23, 50, 255, 236, 173, 186, 114, 195, 155, 231, 188, 140, 229, 187, 197, 247, 18, 107, 44, 67, 155, 58, 64, 0, 0, 0, 218, 136, 223, 51, 158, 165, 31, 125, 51, 95, 141, 189, 233, 28, 179, 134, 163, 220, 32, 253, 196, 249, 160, 163, 50, 179, 54, 211, 231, 31, 42, 94, 2,
    //compute budget - unit limit
    4, 0, 5, 2,
    205, 171, 0, 0, // New compute budget limit
    //system - transfer
    3, 2, 1, 2, 12, 2, 0, 0, 0,
    6, // Transfer 6 lamports
    0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

/**
 * Transfer 6 lamports with compute budget limit and unit price instructions
 */
void test_process_message_body_transfer_with_compute_budget_limit_and_unit_price(){

    uint8_t message[] = {
        2, 0, 2,
        5, 21, 114, 229, 47, 44, 94, 126, 102, 188, 25, 172, 108, 211, 11, 109, 105, 110, 167, 153, 207, 230, 215, 132, 84, 42, 183, 216, 183, 254, 49, 91, 92, 151, 92, 21, 68, 212, 0, 50, 152, 29, 184, 10, 237, 93, 26, 195, 28, 41, 242, 83, 160, 179, 163, 125, 22, 218, 2, 189, 250, 180, 15, 129, 237, 121, 159, 134, 35, 112, 111, 25, 35, 23, 57, 215, 23, 85, 213, 131, 83, 179, 66, 3, 70, 50, 124, 61, 59, 195, 97, 48, 196, 191, 215, 90, 77, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3, 6, 70, 111, 229, 33, 23, 50, 255, 236, 173, 186, 114, 195, 155, 231, 188, 140, 229, 187, 197, 247, 18, 107, 44, 67, 155, 58, 64, 0, 0, 0, 218, 136, 223, 51, 158, 165, 31, 125, 51, 95, 141, 189, 233, 28, 179, 134, 163, 220, 32, 253, 196, 249, 160, 163, 50, 179, 54, 211, 231, 31, 42, 94, 3,
        //compute budget - unit limit
        4, 0, 5, 2,
        205, 171, 0, 0, // New compute budget limit
        4, 0, 9, 3,
        16, 0, 0, 0, 0, 0, 0, 0, // Unit price 16 lamports
        //system - transfer
        3, 2, 1, 2, 12, 2, 0, 0, 0,
        6, // Transfer 6 lamports
        0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);

}

/*
 * Transfer 5 lamports with additional request units instruction
 * Should fail - RequestUnits is deprecated and not supported
 */
void test_process_message_body_transfer_with_request_units(){

    uint8_t message[] = {
        2, 0, 2,
        5, 21, 114, 229, 47, 44, 94, 126, 102, 188, 25, 172, 108, 211, 11, 109, 105, 110, 167, 153, 207, 230, 215, 132, 84, 42, 183, 216, 183, 254, 49, 91, 92, 151, 92, 21, 68, 212, 0, 50, 152, 29, 184, 10, 237, 93, 26, 195, 28, 41, 242, 83, 160, 179, 163, 125, 22, 218, 2, 189, 250, 180, 15, 129, 237, 190, 59, 47, 250, 178, 1, 186, 135, 5, 102, 210, 129, 210, 83, 78, 169, 121, 6, 224, 25, 147, 92, 26, 51, 146, 176, 173, 69, 99, 246, 206, 134, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3, 6, 70, 111, 229, 33, 23, 50, 255, 236, 173, 186, 114, 195, 155, 231, 188, 140, 229, 187, 197, 247, 18, 107, 44, 67, 155, 58, 64, 0, 0, 0, 250, 188, 80, 35, 70, 214, 185, 174, 0, 85, 72, 57, 132, 27, 182, 217, 110, 155, 200, 108, 152, 84, 26, 168, 236, 225, 222, 143, 69, 140, 60, 201, 2,
        //compute budget - unit limit
        4, 0, 9, 0,
        2, 0, 0, 0, // Units (lamports) = 2
        1, 0, 0, 0, // Additional fee = 1,
        //system - transfer
        3, 2, 1, 2, 12, 2, 0, 0, 0,
        5, // Transfer 5 lamports
        0, 0, 0, 0, 0, 0, 0
    };

    PrintConfig print_config;
    Parser parser = { message, sizeof(message) };
    assert(parse_message_header(&parser, &print_config.header) == 0);

    transaction_summary_reset();
    assert(process_message_body(parser.buffer, parser.buffer_length, &print_config) == 1);

}

void test_process_message_body_transfer_with_heap_frame(){

    uint8_t message[] = {
    2, 0, 2,
    5, 21, 114, 229, 47, 44, 94, 126, 102, 188, 25, 172, 108, 211, 11, 109, 105, 110, 167, 153, 207, 230, 215, 132, 84, 42, 183, 216, 183, 254, 49, 91, 92, 151, 92, 21, 68, 212, 0, 50, 152, 29, 184, 10, 237, 93, 26, 195, 28, 41, 242, 83, 160, 179, 163, 125, 22, 218, 2, 189, 250, 180, 15, 129, 237, 85, 241, 243, 183, 151, 207, 142, 210, 108, 198, 224, 74, 55, 239, 133, 160, 214, 5, 194, 146, 151, 245, 221, 22, 236, 240, 44, 213, 111, 1, 175, 209, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    3, 6, 70, 111, 229, 33, 23, 50, 255, 236, 173, 186, 114, 195, 155, 231, 188, 140, 229, 187, 197, 247, 18, 107, 44, 67, 155, 58, 64, 0, 0, 0, 8, 142, 237, 31, 151, 51, 227, 223, 112, 195, 240, 42, 185, 66, 83, 129, 10, 87, 175, 124, 84, 108, 23, 194, 79, 130, 56, 226, 197, 55, 25, 151, 2,
    //compute budget - unit limit
    4, 0, 5, 1,
    204, 214, 90, 29,  // Bytes 0x1D 0x5A 0xD6 0xCC
    //system - transfer
    3, 2, 1, 2, 12, 2, 0, 0, 0,
    7, // Transfer 7 lamports
    0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);

}



void test_process_message_body_nonced_stake_create_with_seed() {
    uint8_t message[] = {
        2, 1, 4,
        8,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            247, 157, 35, 131, 179, 105, 135, 105, 0, 178, 6, 62, 22, 251, 47, 102, 208, 237, 66, 72, 149, 5, 127, 149, 253, 28, 66, 250, 52, 173, 30, 105,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3,
            // system - advance nonce
            6,
            3,
                2, 4, 1,
            4,
                4, 0, 0, 0,
            // system - create account with seed
            6,
            2,
                0, 3,
            124,
                3, 0, 0, 0,
                18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
                32, 0, 0, 0, 0, 0, 0, 0,
                    115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100,
                42, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake - initialize
            7,
            2,
                3, 5,
            116,
                0, 0, 0, 0,
                3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
                4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
                1, 0, 0, 0, 0, 0, 0, 0,
                1, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 13);
}

void test_process_message_body_create_stake_account() {
    uint8_t message[] = {
        2, 0, 3,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - create account
            3,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake - initialize
            4,
            2,
                1, 2,
            116,
                0, 0, 0, 0,
                3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
                4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
                1, 0, 0, 0, 0, 0, 0, 0,
                1, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 9);
}

void test_process_message_body_create_stake_account_no_lockup() {
    uint8_t message[] = {
        2, 0, 3,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - create account
            3,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake - initialize
            4,
            2,
                1, 2,
            116,
                0, 0, 0, 0,
                3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
                4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
                0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 7);
}

void test_process_message_body_nonced_stake_create_with_seed_checked() {
    uint8_t message[] = {
        3, 2, 5,
        10,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            247, 157, 35, 131, 179, 105, 135, 105, 0, 178, 6, 62, 22, 251, 47, 102, 208, 237, 66, 72, 149, 5, 127, 149, 253, 28, 66, 250, 52, 173, 30, 105,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
            PROGRAM_ID_SYSTEM,
            PROGRAM_ID_STAKE,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3,
            // system - advance nonce
            8,
            3,
                3, 5, 1,
            4,
                4, 0, 0, 0,
            // system - create account with seed
            8,
            2,
                0, 4,
            124,
                3, 0, 0, 0,
                18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
                32, 0, 0, 0, 0, 0, 0, 0,
                    115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100,
                42, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                PROGRAM_ID_STAKE,
            // stake - initialize checked
            9,
            4,
                4, 6, 7, 2,
            4,
                9, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 11);
}

void test_process_message_body_create_stake_account_checked() {
    uint8_t message[] = {
        3, 1, 4,
        7,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
            PROGRAM_ID_SYSTEM,
            PROGRAM_ID_STAKE,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - create account
            5,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                PROGRAM_ID_STAKE,
            // stake - initialize checked
            6,
            4,
                1, 3, 4, 2,
            4,
                9, 0, 0, 0,
    };

    process_message_body_and_sanity_check(message, sizeof(message), 7); // no lockup
}

void test_process_message_body_create_nonce_account() {
    uint8_t message[] = {
        2, 0, 3,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - create account
            4,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0,
                80, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            // system - initialize nonce
            4,
            3,
                1, 2, 3,
            36,
                6, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_create_nonce_account_with_seed() {
    uint8_t message[] = {
        1, 0, 3,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            133, 66, 139, 176, 93, 124, 142, 23, 153, 82, 31, 46, 236, 244, 156, 121, 7, 225, 187, 61, 33, 34, 179, 138, 134, 108, 157, 56, 213, 162, 32, 68,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - create account with seed
            4,
            2,
                0, 1,
            124,
                3, 0, 0, 0,
                18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
                32, 0, 0, 0, 0, 0, 0, 0,
                    115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100,
                42, 0, 0, 0, 0, 0, 0, 0,
                80, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            // system - initialize nonce
            4,
            3,
                1, 2, 3,
            36,
                6, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    };

    process_message_body_and_sanity_check(message, sizeof(message), 7);
}

void test_process_message_body_create_vote_account() {
    uint8_t message[] = {
        2, 0, 4,
        6,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - create account
            4,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0,
                147, 14, 0, 0, 0, 0, 0, 0,
                7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
            // vote - initialize
            5,
            3,
                1, 2, 3,
            101,
                0, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
                50
    };

    process_message_body_and_sanity_check(message, sizeof(message), 8);
}

void test_process_message_body_create_vote_account_with_seed() {
    uint8_t message[] = {
        1, 0, 4,
        6,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            228, 28, 89, 247, 92, 128, 175, 120, 101, 30, 55, 24, 60, 143, 49, 55, 57, 67, 79, 63, 90, 198, 149, 232, 85, 165, 148, 141, 164, 223, 110, 211,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - create account with seed
            4,
            2,
                0, 1,
            124,
                3, 0, 0, 0,
                18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
                32, 0, 0, 0, 0, 0, 0, 0,
                    115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100,
                42, 0, 0, 0, 0, 0, 0, 0,
                147, 14, 0, 0, 0, 0, 0, 0,
                7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
            // vote - initialize
            5,
            3,
                1, 2, 3,
            101,
                0, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
                50
    };

    process_message_body_and_sanity_check(message, sizeof(message), 10);
}

void test_process_message_body_nonce_withdraw() {
    uint8_t message[] = {
        1, 1, 3,
        6,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // system - nonce withdraw
            5,
            5,
                1, 2, 3, 4, 0,
            12,
                5, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_stake_withdraw() {
    uint8_t message[] = {
        1, 1, 3,
        6,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 167, 213, 23, 25, 53, 132, 208, 254, 237, 155, 179, 67, 29, 19, 32, 107, 229, 68, 40, 27, 87, 184, 86, 108, 197, 55, 95, 244, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // stake - withdraw
            5,
            5,
                1, 2, 3, 4, 0,
            12,
                4, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_vote_withdraw() {
    uint8_t message[] = {
        1, 1, 1,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // vote - withdraw
            3,
            3,
                1, 2, 0,
            12,
                3, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_system_nonce_authorize() {
    uint8_t message[] = {
        1, 1, 1,
        3,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // system - authorize nonce
            2,
            2,
                1, 0,
            36,
                7, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_stake_authorize_staker() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            PROGRAM_ID_STAKE,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // stake - authorize
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                0, 0, 0, 0 // staker
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_stake_authorize_withdrawer() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // stake - authorize
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_stake_authorize_withdrawer_with_custodian() {
    uint8_t message[] = {
      3, 2, 2,
      5,
          19, 144, 25, 80, 156, 114, 186, 66, 29, 241, 166, 151, 127, 235, 131, 211, 64, 194, 62, 195, 227, 161, 166, 82, 59, 204, 214, 44, 193, 158, 63, 169,
          10, 197, 71, 166, 84, 143, 238, 106, 60, 71, 210, 140, 50, 46, 5, 64, 197, 233, 184, 185, 240, 1, 189, 60, 85, 208, 255, 255, 23, 193, 128, 222,
          1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
          6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      1,
          // stake - authorize
          4,
          4,
              0, 3, 1, 2,
          40,
              1, 0, 0, 0,
              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
              1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_stake_authorize_both() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // stake - authorize
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                0, 0, 0, 0, // staker
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_stake_authorize_staker_checked() {
    uint8_t message[] = {
        2, 1, 2,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            PROGRAM_ID_STAKE,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // stake - authorize checked
            4,
            4,
                2, 3, 0, 1,
            8,
                10, 0, 0, 0,
                0, 0, 0, 0 // staker
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_stake_authorize_withdrawer_checked() {
    uint8_t message[] = {
        2, 1, 2,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            PROGRAM_ID_STAKE,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // stake - authorize checked
            4,
            4,
                2, 3, 0, 1,
            8,
                10, 0, 0, 0,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_stake_authorize_withdrawer_with_custodian_checked() {
    uint8_t message[] = {
      3, 2, 2,
      6,
          19, 144, 25, 80, 156, 114, 186, 66, 29, 241, 166, 151, 127, 235, 131, 211, 64, 194, 62, 195, 227, 161, 166, 82, 59, 204, 214, 44, 193, 158, 63, 169,
          2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
          10, 197, 71, 166, 84, 143, 238, 106, 60, 71, 210, 140, 50, 46, 5, 64, 197, 233, 184, 185, 240, 1, 189, 60, 85, 208, 255, 255, 23, 193, 128, 222,
          1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
          6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
          PROGRAM_ID_STAKE,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      1,
          // stake - authorize checked
          5,
          5,
              3, 4, 0, 1, 2,
          8,
              10, 0, 0, 0,
              1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_stake_authorize_both_checked() {
    uint8_t message[] = {
        3, 2, 2,
        6,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            PROGRAM_ID_STAKE,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // stake - authorize checked
            5,
            4,
                3, 4, 0, 1,
            8,
                10, 0, 0, 0,
                0, 0, 0, 0, // staker
            5,
            4,
                3, 4, 0, 2,
            8,
                10, 0, 0, 0,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_vote_authorize_voter() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // vote - authorize
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                0, 0, 0, 0 // voter
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_vote_authorize_withdrawer() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // vote - authorize
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_vote_authorize_both() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // vote - authorize
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                0, 0, 0, 0, // voter
            // vote - authorize
            3,
            3,
                1, 2, 0,
            40,
                1, 0, 0, 0,
                2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_vote_authorize_voter_checked() {
    uint8_t message[] = {
        2, 1, 2,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // vote - authorize checked
            4,
            4,
                2, 3, 0, 1,
            8,
                7, 0, 0, 0,
                0, 0, 0, 0 // voter
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_vote_authorize_withdrawer_checked() {
    uint8_t message[] = {
        2, 1, 2,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // vote - authorize checked
            4,
            4,
                2, 3, 0, 1,
            8,
                7, 0, 0, 0,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_vote_authorize_both_checked() {
    uint8_t message[] = {
        2, 1, 2,
        6,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // vote - authorize
            5,
            4,
                3, 4, 0, 1,
            8,
                7, 0, 0, 0,
                0, 0, 0, 0, // voter
            // vote - authorize
            5,
            4,
                3, 4, 0, 2,
            8,
                7, 0, 0, 0,
                1, 0, 0, 0 // withdrawer
    };

    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_vote_update_node_v1_0_7() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // vote - update node
            3,
            3,
                1, 2, 0,
            36,
                4, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);

    Pubkey expected_node = {{
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    }};
    char bs58_expected[BASE58_PUBKEY_LENGTH];
    encode_base58(&expected_node, sizeof(expected_node), bs58_expected, sizeof(bs58_expected));
    char expected[SUMMARY_LENGTH + 2 + SUMMARY_LENGTH + 1];
    print_summary(bs58_expected, expected, sizeof(expected), SUMMARY_LENGTH, SUMMARY_LENGTH);

    transaction_summary_display_item(1, DisplayFlagNone); // node id
    assert_string_equal(G_transaction_summary_text, expected);
}

void test_process_message_body_vote_update_node_v1_0_8() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            // vote - update node
            3,
            3,
                1, 2, 0,
            4,
                4, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);

    Pubkey expected_node = {{
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    }};
    char bs58_expected[BASE58_PUBKEY_LENGTH];
    encode_base58(&expected_node, sizeof(expected_node), bs58_expected, sizeof(bs58_expected));
    char expected[SUMMARY_LENGTH + 2 + SUMMARY_LENGTH + 1];
    print_summary(bs58_expected, expected, sizeof(expected), SUMMARY_LENGTH, SUMMARY_LENGTH);

    transaction_summary_display_item(1, DisplayFlagNone); // node id
    assert_string_equal(G_transaction_summary_text, expected);
}

void test_process_message_body_vote_update_commission() {
    uint8_t message[] = {
        2, 1, 1,
        3,
            19, 144, 25, 80, 156, 114, 186, 66, 29, 241, 166, 151, 127, 235, 131, 211, 64, 194, 62, 195, 227, 161, 166, 82, 59, 204, 214, 44, 193, 158, 63, 169,
            10, 197, 71, 166, 84, 143, 238, 106, 60, 71, 210, 140, 50, 46, 5, 64, 197, 233, 184, 185, 240, 1, 189, 60, 85, 208, 255, 255, 23, 193, 128, 222,
            7, 97, 72, 29, 53, 116, 116, 187, 124, 77, 118, 36, 235, 211, 189, 179, 216, 53, 94, 115, 209, 16, 67, 252, 13, 163, 83, 128, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            2,
            2,
                0, 1,
            5,
                5, 0, 0, 0,
                42
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_stake_delegate() {
    uint8_t message[] = {
        2, 1, 5,
        7,
            226, 227, 159, 49, 174, 54, 249, 204, 163, 243, 214, 226, 72, 231, 254, 47, 54, 154, 232, 93, 76, 4, 41, 84, 228, 188, 210, 93, 163, 211, 181, 118,
            147, 11, 169, 119, 49, 240, 218, 2, 64, 0, 238, 67, 133, 163, 239, 139, 225, 13, 87, 18, 112, 254, 144, 118, 171, 151, 140, 122, 64, 17, 230, 66,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 167, 213, 23, 25, 53, 132, 208, 254, 237, 155, 179, 67, 29, 19, 32, 107, 229, 68, 40, 27, 87, 184, 86, 108, 197, 55, 95, 244, 0, 0, 0,
            6, 161, 216, 23, 165, 2, 5, 11, 104, 7, 145, 230, 206, 109, 184, 142, 30, 91, 113, 80, 246, 31, 198, 121, 10, 78, 180, 209, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            6,
            6,
                0, 2, 3, 4, 5, 1,
            4,
                2, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_stake_delegate_with_nonce() {
    uint8_t message[] = {
        1, 1, 7,
        10,
            147, 11, 169, 119, 49, 240, 218, 2, 64, 0, 238, 67, 133, 163, 239, 139, 225, 13, 87, 18, 112, 254, 144, 118, 171, 151, 140, 122, 64, 17, 230, 66,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            226, 227, 159, 49, 174, 54, 249, 204, 163, 243, 214, 226, 72, 231, 254, 47, 54, 154, 232, 93, 76, 4, 41, 84, 228, 188, 210, 93, 163, 211, 181, 118,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 167, 213, 23, 25, 53, 132, 208, 254, 237, 155, 179, 67, 29, 19, 32, 107, 229, 68, 40, 27, 87, 184, 86, 108, 197, 55, 95, 244, 0, 0, 0,
            6, 161, 216, 23, 165, 2, 5, 11, 104, 7, 145, 230, 206, 109, 184, 142, 30, 91, 113, 80, 246, 31, 198, 121, 10, 78, 180, 209, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            8,
            3,
                1, 3, 0,
            4,
                4, 0, 0, 0,

            9,
            6,
                2, 4, 5, 6, 7, 0,
            4,
                2, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 6);
}

void test_process_message_body_create_stake_account_and_delegate() {
    uint8_t message[] = {
        3, 1, 7,
        10,
            226, 227, 159, 49, 174, 54, 249, 204, 163, 243, 214, 226, 72, 231, 254, 47, 54, 154, 232, 93, 76, 4, 41, 84, 228, 188, 210, 93, 163, 211, 181, 118,
            147, 11, 169, 119, 49, 240, 218, 2, 64, 0, 238, 67, 133, 163, 239, 139, 225, 13, 87, 18, 112, 254, 144, 118, 171, 151, 140, 122, 64, 17, 230, 66,
            3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 167, 213, 23, 25, 53, 132, 208, 254, 237, 155, 179, 67, 29, 19, 32, 107, 229, 68, 40, 27, 87, 184, 86, 108, 197, 55, 95, 244, 0, 0, 0,
            6, 161, 216, 23, 165, 2, 5, 11, 104, 7, 145, 230, 206, 109, 184, 142, 30, 91, 113, 80, 246, 31, 198, 121, 10, 78, 180, 209, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3,
            // system create account
            8,
            2,
                1, 0,
            52,
                0, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake initialize
            9,
            2,
                0, 3,
            116,
                0, 0, 0, 0,
                3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
                4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
                1, 0, 0, 0, 0, 0, 0, 0,
                1, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            // stake delegate
            9,
            6,
                0, 4, 5, 6, 7, 2,
            4,
                2, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 11);
}

void test_process_message_body_create_stake_with_seed_account_and_delegate() {
    uint8_t message[] = {
        2, 0, 7,
        10,
            226, 227, 159, 49, 174, 54, 249, 204, 163, 243, 214, 226, 72, 231, 254, 47, 54, 154, 232, 93, 76, 4, 41, 84, 228, 188, 210, 93, 163, 211, 181, 118,
            147, 11, 169, 119, 49, 240, 218, 2, 64, 0, 238, 67, 133, 163, 239, 139, 225, 13, 87, 18, 112, 254, 144, 118, 171, 151, 140, 122, 64, 17, 230, 66,
            160, 209, 181, 140, 74, 150, 96, 248, 38, 191, 49, 248, 172, 163, 99, 167, 79, 223, 32, 215, 58, 177, 147, 143, 129, 151, 59, 99, 20, 145, 156, 145,
            6, 167, 213, 23, 25, 44, 92, 81, 33, 140, 201, 76, 61, 74, 241, 127, 88, 218, 238, 8, 155, 161, 253, 68, 227, 219, 217, 138, 0, 0, 0, 0,
            5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 167, 213, 23, 25, 53, 132, 208, 254, 237, 155, 179, 67, 29, 19, 32, 107, 229, 68, 40, 27, 87, 184, 86, 108, 197, 55, 95, 244, 0, 0, 0,
            6, 161, 216, 23, 165, 2, 5, 11, 104, 7, 145, 230, 206, 109, 184, 142, 30, 91, 113, 80, 246, 31, 198, 121, 10, 78, 180, 209, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3,
            // system create account with seed
            8,
            3,
                1, 2, 1,
            124,
                3, 0, 0, 0,
                147, 11, 169, 119, 49, 240, 218, 2, 64, 0, 238, 67, 133, 163, 239, 139, 225, 13, 87, 18, 112, 254, 144, 118, 171, 151, 140, 122, 64, 17, 230, 66,
                32, 0, 0, 0, 0, 0, 0, 0,
                    115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100,
                42, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake initialize
            9,
            2,
                2, 3,
            116,
                0, 0, 0, 0,
                148, 11, 169, 119, 49, 240, 218, 2, 64, 0, 238, 67, 133, 163, 239, 139, 225, 13, 87, 18, 112, 254, 144, 118, 171, 151, 140, 122, 64, 17, 230, 66,
                147, 11, 169, 119, 49, 240, 218, 2, 64, 0, 238, 67, 133, 163, 239, 139, 225, 13, 87, 18, 112, 254, 144, 118, 171, 151, 140, 122, 64, 17, 230, 66,
                1, 0, 0, 0, 0, 0, 0, 0,
                1, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            // stake delegate
            9,
            6,
                2, 4, 5, 6, 7, 1,
            4,
                2, 0, 0, 0
    };
    process_message_body_and_sanity_check(message, sizeof(message), 13);
}

void test_process_message_body_stake_deactivate() {
    uint8_t message[] = {
        1, 1, 2,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 24, 199, 116, 201, 40, 86, 99, 152, 105, 29, 94, 182, 139, 94, 184, 163, 155, 75, 109, 92, 115, 85, 91, 33, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            3,
            3,
                1, 2, 0,
            4,
                5, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 3);
}

void test_process_message_body_stake_set_lockup() {
    uint8_t message[] = {
        1, 1, 1,
        3,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            2,
            2,
                1, 0,
            55,
                6, 0, 0, 0,
                1,
                    1, 0, 0, 0, 0, 0, 0, 0,
                1,
                    2, 0, 0, 0, 0, 0, 0, 0,
                1,
                    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    };

    process_message_body_and_sanity_check(message, sizeof(message), 6);
}

void test_process_message_body_stake_set_lockup_checked() {
    uint8_t message[] = {
        2, 1, 1,
        4,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,
            3,
            3,
                2, 0, 1,
            22,
                12, 0, 0, 0,
                1,
                    1, 0, 0, 0, 0, 0, 0, 0,
                1,
                    2, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 6);
}

// Using a nonce here to test worst case instruction usage as well
void test_process_message_body_stake_split_with_nonce_v1_1() {
    uint8_t message[] = {
        3, 2, 3,
        8,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        4,
            // system - advance nonce
            6,
            3,
                3, 5, 1,
            4,
                4, 0, 0, 0,
            // system - allocate
            6,
            1,
                0,
            12,
                8, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
            // system - assign
            6,
            1,
                0,
            36,
                1, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake - split
            7,
            3,
                4, 0, 2,
            12,
                3, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 7);
}

// Using a nonce here to test worst case instruction usage as well
void test_process_message_body_stake_split_with_nonce_v1_2() {
    uint8_t message[] = {
        3, 1, 3,
        8,
            10, 197, 71, 166, 84, 143, 238, 106, 60, 71, 210, 140, 50, 46, 5, 64, 197, 233, 184, 185, 240, 1, 189, 60, 85, 208, 255, 255, 23, 193, 128, 222,
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
            3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
            2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
            19, 144, 25, 80, 156, 114, 186, 66, 29, 241, 166, 151, 127, 235, 131, 211, 64, 194, 62, 195, 227, 161, 166, 82, 59, 204, 214, 44, 193, 158, 63, 169,
            6, 167, 213, 23, 25, 44, 86, 142, 224, 138, 132, 95, 115, 210, 151, 136, 207, 3, 92, 49, 69, 178, 26, 179, 68, 216, 6, 46, 169, 64, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3,
            // system - advance nonce
            6,
            3,
                3, 5, 2,
            4,
                4, 0, 0, 0,
            // system - create account
            6,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake - split
            7,
            3,
                4, 1, 0,
            12,
                3, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 7);
}

void test_process_message_body_stake_split_with_seed_v1_1() {
    uint8_t message[] = {
        1, 1, 2,
        5,
            18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
            247, 157, 35, 131, 179, 105, 135, 105, 0, 178, 6, 62, 22, 251, 47, 102, 208, 237, 66, 72, 149, 5, 127, 149, 253, 28, 66, 250, 52, 173, 30, 105,
            112, 173, 25, 161, 89, 143, 220, 223, 128, 33, 149, 41, 12, 152, 202, 202, 203, 163, 182, 246, 158, 15, 22, 77, 171, 71, 63, 249, 10, 117, 172, 52,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        2,
            // system - allocate with seed
            3,
            2,
                1, 0,
            116,
                9, 0, 0, 0,
                18, 67, 85, 168, 124, 173, 88, 142, 77, 171, 80, 178, 8, 218, 230, 68, 85, 231, 39, 54, 184, 42, 162, 85, 172, 139, 54, 173, 194, 7, 64, 250,
                32, 0, 0, 0, 0, 0, 0, 0,
                    115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100,
                    200, 0, 0, 0, 0, 0, 0, 0,
                    6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
            // stake - split
            4,
            3,
                2, 1, 0,
            12,
                3, 0, 0, 0,
                42, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 7);
}

void test_process_message_body_stake_split_with_seed_v1_2() {
    uint8_t message[] = {
        2, 0, 2,
        5,
            19, 144, 25, 80, 156, 114, 186, 66, 29, 241, 166, 151, 127, 235, 131, 211, 64, 194, 62, 195, 227, 161, 166, 82, 59, 204, 214, 44, 193, 158, 63, 169,
            10, 197, 71, 166, 84, 143, 238, 106, 60, 71, 210, 140, 50, 46, 5, 64, 197, 233, 184, 185, 240, 1, 189, 60, 85, 208, 255, 255, 23, 193, 128, 222,
            92, 85, 182, 94, 208, 4, 87, 44, 2, 143, 234, 65, 18, 230, 233, 103, 90, 98, 237, 101, 221, 207, 74, 86, 79, 234, 250, 9, 124, 242, 40, 212,
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        // system - create account with seed
        2,
        3,
            2, 1, 2,
        124,
            3, 0, 0, 0,
            10, 197, 71, 166, 84, 143, 238, 106, 60, 71, 210, 140, 50, 46, 5, 64, 197, 233, 184, 185, 240, 1, 189, 60, 85, 208, 255, 255, 23, 193, 128, 222,
            32, 0, 0, 0, 0, 0, 0, 0,
                115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100, 115, 101, 101, 100,
                0, 0, 0, 0, 0, 0, 0, 0,
                200, 0, 0, 0, 0, 0, 0, 0,
                6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0,
        // stake - split
        4,
        3,
            0, 2, 1,
        12,
            3, 0, 0, 0,
            42, 0, 0, 0, 0, 0, 0, 0
    };

    process_message_body_and_sanity_check(message, sizeof(message), 7);
}

void test_process_message_body_stake_merge() {
    uint8_t message[] = {
        0x01, 0x00, 0x03,
        0x06,
            0x0a, 0xc5, 0x47, 0xa6, 0x54, 0x8f, 0xee, 0x6a, 0x3c, 0x47, 0xd2, 0x8c, 0x32, 0x2e, 0x05, 0x40,
                0xc5, 0xe9, 0xb8, 0xb9, 0xf0, 0x01, 0xbd, 0x3c, 0x55, 0xd0, 0xff, 0xff, 0x17, 0xc1, 0x80, 0xde,
            0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x06, 0xa7, 0xd5, 0x17, 0x18, 0xc7, 0x74, 0xc9, 0x28, 0x56, 0x63, 0x98, 0x69, 0x1d, 0x5e, 0xb6,
                0x8b, 0x5e, 0xb8, 0xa3, 0x9b, 0x4b, 0x6d, 0x5c, 0x73, 0x55, 0x5b, 0x21, 0x00, 0x00, 0x00, 0x00,
            0x06, 0xa7, 0xd5, 0x17, 0x19, 0x35, 0x84, 0xd0, 0xfe, 0xed, 0x9b, 0xb3, 0x43, 0x1d, 0x13, 0x20,
                0x6b, 0xe5, 0x44, 0x28, 0x1b, 0x57, 0xb8, 0x56, 0x6c, 0xc5, 0x37, 0x5f, 0xf4, 0x00, 0x00, 0x00,
            0x06, 0xa1, 0xd8, 0x17, 0x91, 0x37, 0x54, 0x2a, 0x98, 0x34, 0x37, 0xbd, 0xfe, 0x2a, 0x7a, 0xb2,
                0x55, 0x7f, 0x53, 0x5c, 0x8a, 0x78, 0x72, 0x2b, 0x68, 0xa4, 0x9d, 0xc0, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01,
            // stake - merge
            0x05,
            0x05,
                0x01, 0x02, 0x03, 0x04, 0x00,
            0x04,
                0x07, 0x00, 0x00, 0x00,
    };
    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

#define BLOCKHASH       BYTES32_BS58_1
#define MINT_ACCOUNT    BYTES32_BS58_2
#define TOKEN_ACCOUNT   BYTES32_BS58_3
#define OWNER_ACCOUNT   BYTES32_BS58_4
#define MULTISIG_ACCOUNT    OWNER_ACCOUNT
#define SIGNER1         BYTES32_BS58_5
#define SIGNER2         BYTES32_BS58_6
#define SIGNER3         BYTES32_BS58_7
#define DEST_ACCOUNT    BYTES32_BS58_8
#define DELEGATE        DEST_ACCOUNT
#define NEW_OWNER       DEST_ACCOUNT

void test_process_message_body_spl_token_create_token() {
    uint8_t message[] = {
        2, 0, 3,
        5,
            OWNER_ACCOUNT,
            MINT_ACCOUNT,
            SYSVAR_RENT,
            PROGRAM_ID_SYSTEM,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        2,
            3,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                245, 1, 0, 0, 0, 0, 0, 0,
                88, 0, 0, 0, 0, 0, 0, 0,
                PROGRAM_ID_SPL_TOKEN,
            4,
            2,
                1, 2,
            35,
                0,
                9,
                OWNER_ACCOUNT,
                0
    };
    process_message_body_and_sanity_check(message, sizeof(message), 6);
}

void test_process_message_body_spl_token_create_account() {
    uint8_t message[] = {
        0x02, 0x00, 0x03,
        0x06,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            MINT_ACCOUNT,
            SYSVAR_RENT,
            PROGRAM_ID_SYSTEM,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        0x02,
            // SystemCreateAccount
            0x04,
            0x02,
                0x00, 0x01,
            0x34,
                0x00, 0x00, 0x00, 0x00,
                0x80, 0x56, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                PROGRAM_ID_SPL_TOKEN,
            // SplTokenInitializeAccount
            0x05,
            0x04,
                0x01, 0x02, 0x00, 0x03,
            0x01,
                0x01,
    };
    process_message_body_and_sanity_check(message, sizeof(message), 6);
}

void test_process_message_body_spl_token_create_account2() {
    uint8_t message[] = {
        0x02, 0x00, 0x04,
        0x06,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            MINT_ACCOUNT,
            SYSVAR_RENT,
            PROGRAM_ID_SYSTEM,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        0x02,
            // SystemCreateAccount
            0x04,
            0x02,
                0x00, 0x01,
            0x34,
                0x00, 0x00, 0x00, 0x00,
                0x80, 0x56, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                PROGRAM_ID_SPL_TOKEN,
            // SplTokenInitializeAccount
            0x05,
            0x03,
                0x01, 0x02, 0x00,
            0x21,
                0x10,
                OWNER_ACCOUNT,
    };
    process_message_body_and_sanity_check(message, sizeof(message), 6);
}

void test_process_message_body_spl_token_create_multisig() {
    uint8_t message[] = {
        2, 0, 5,
        8,
            OWNER_ACCOUNT,
            MULTISIG_ACCOUNT,
            SIGNER1,
            SIGNER2,
            SIGNER3,
            SYSVAR_RENT,
            PROGRAM_ID_SYSTEM,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        2,
            // SystemCreateAccount
            6,
            2,
                0, 1,
            52,
                0, 0, 0, 0,
                245, 1, 0, 0, 0, 0, 0, 0,
                40, 0, 0, 0, 0, 0, 0, 0,
                PROGRAM_ID_SPL_TOKEN,
            // SplTokenInitializeMultisig
            7,
            5,
                1, 5, 2, 3, 4,
            2,
                2,
                2
    };
    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_spl_token_transfer() {
    uint8_t message[] = {
        1, 0, 2,
        5,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            DEST_ACCOUNT,
            MINT_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            4,
            4,
                1, 3, 2, 0,
            10,
                12,
                42, 0, 0, 0, 0, 0, 0, 0,
                9
    };
    process_message_body_and_sanity_check(message, sizeof(message), 7);
}

void test_process_message_body_spl_token_approve() {
    uint8_t message[] = {
        1, 0, 2,
        5,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            MINT_ACCOUNT,
            DEST_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            4,
            4,
                1, 2, 3, 0,
            10,
                13,
                42, 0, 0, 0, 0, 0, 0, 0,
                9
    };
    process_message_body_and_sanity_check(message, sizeof(message), 6);
}

void test_process_message_body_spl_token_revoke() {
    uint8_t message[] = {
        1, 0, 2,
        3,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            2,
            2,
                1, 0,
            1,
                5
    };
    process_message_body_and_sanity_check(message, sizeof(message), 3);
}

void test_process_message_body_spl_token_set_authority() {
    uint8_t message[] = {
        1, 0, 1,
        3,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            2,
            2,
                1, 0,
            35,
                6,
                2,
                1,
                    NEW_OWNER
    };
    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_spl_token_mint_to() {
    uint8_t message[] = {
        1, 0, 0,
        4,
            OWNER_ACCOUNT,
            MINT_ACCOUNT,
            TOKEN_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            3,
            3,
                1, 2, 0,
            10,
                14,
                42, 0, 0, 0, 0, 0, 0, 0,
                9
    };
    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_spl_token_burn() {
    uint8_t message[] = {
        1, 0, 0,
        4,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            MINT_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            3,
            3,
                1, 2, 0,
            10,
                15,
                42, 0, 0, 0, 0, 0, 0, 0,
                9
    };
    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_spl_token_close_account() {
    uint8_t message[] = {
        0x01, 0x00, 0x01,
        0x03,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        0x01,
            // SplTokenCloseAccount
            0x02,
            0x03,
                0x01, 0x00, 0x00,
            0x01,
                0x09,
    };
    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_spl_token_freeze_account() {
    uint8_t message[] = {
        1, 0, 2,
        4,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            MINT_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            3,
            3,
                1, 2, 0,
            1,
                10
    };
    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_spl_token_thaw_account() {
    uint8_t message[] = {
        1, 0, 2,
        4,
            OWNER_ACCOUNT,
            TOKEN_ACCOUNT,
            MINT_ACCOUNT,
            PROGRAM_ID_SPL_TOKEN,
        BLOCKHASH,
        1,
            3,
            3,
                1, 2, 0,
            1,
                11
    };
    process_message_body_and_sanity_check(message, sizeof(message), 4);
}

void test_process_message_body_spl_associated_token_create() {
    uint8_t message[] = {
        0x01, 0x00, 0x05,
        0x06,
            0x0a, 0xc5, 0x47, 0xa6, 0x54, 0x8f, 0xee, 0x6a, 0x3c, 0x47, 0xd2, 0x8c, 0x32, 0x2e, 0x05, 0x40, 0xc5, 0xe9, 0xb8, 0xb9, 0xf0, 0x01, 0xbd, 0x3c, 0x55, 0xd0, 0xff, 0xff, 0x17, 0xc1, 0x80, 0xde,
            0x1d, 0x30, 0x63, 0xde, 0x69, 0x0b, 0xcd, 0xbe, 0x38, 0xec, 0x74, 0x44, 0x99, 0x23, 0x20, 0x25, 0xc1, 0xad, 0x64, 0x92, 0x6e, 0xd5, 0x6c, 0x69, 0xa5, 0xe3, 0x10, 0x34, 0x41, 0x19, 0xcb, 0x57,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x06, 0xdd, 0xf6, 0xe1, 0xd7, 0x65, 0xa1, 0x93, 0xd9, 0xcb, 0xe1, 0x46, 0xce, 0xeb, 0x79, 0xac, 0x1c, 0xb4, 0x85, 0xed, 0x5f, 0x5b, 0x37, 0x91, 0x3a, 0x8c, 0xf5, 0x85, 0x7e, 0xff, 0x00, 0xa9,
            0x8c, 0x97, 0x25, 0x8f, 0x4e, 0x24, 0x89, 0xf1, 0xbb, 0x3d, 0x10, 0x29, 0x14, 0x8e, 0x0d, 0x83, 0x0b, 0x5a, 0x13, 0x99, 0xda, 0xff, 0x10, 0x84, 0x04, 0x8e, 0x7b, 0xd8, 0xdb, 0xe9, 0xf8, 0x59,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01,
            // SPL Associate Token Account -- Create
            0x05,
            0x06,
                0x00, 0x01, 0x00, 0x02, 0x03, 0x04,
            0x00,
    };
    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

// old version of ata create that accessed the rent sysvar via account load
void test_process_message_body_spl_associated_token_create_deprecated() {
    uint8_t message[] = {
        0x01, 0x00, 0x05,
        0x07,
            0x0a, 0xc5, 0x47, 0xa6, 0x54, 0x8f, 0xee, 0x6a, 0x3c, 0x47, 0xd2, 0x8c, 0x32, 0x2e, 0x05, 0x40, 0xc5, 0xe9, 0xb8, 0xb9, 0xf0, 0x01, 0xbd, 0x3c, 0x55, 0xd0, 0xff, 0xff, 0x17, 0xc1, 0x80, 0xde,
            0x1d, 0x30, 0x63, 0xde, 0x69, 0x0b, 0xcd, 0xbe, 0x38, 0xec, 0x74, 0x44, 0x99, 0x23, 0x20, 0x25, 0xc1, 0xad, 0x64, 0x92, 0x6e, 0xd5, 0x6c, 0x69, 0xa5, 0xe3, 0x10, 0x34, 0x41, 0x19, 0xcb, 0x57,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x06, 0xdd, 0xf6, 0xe1, 0xd7, 0x65, 0xa1, 0x93, 0xd9, 0xcb, 0xe1, 0x46, 0xce, 0xeb, 0x79, 0xac, 0x1c, 0xb4, 0x85, 0xed, 0x5f, 0x5b, 0x37, 0x91, 0x3a, 0x8c, 0xf5, 0x85, 0x7e, 0xff, 0x00, 0xa9,
            0x06, 0xa7, 0xd5, 0x17, 0x19, 0x2c, 0x5c, 0x51, 0x21, 0x8c, 0xc9, 0x4c, 0x3d, 0x4a, 0xf1, 0x7f, 0x58, 0xda, 0xee, 0x08, 0x9b, 0xa1, 0xfd, 0x44, 0xe3, 0xdb, 0xd9, 0x8a, 0x00, 0x00, 0x00, 0x00,
            0x8c, 0x97, 0x25, 0x8f, 0x4e, 0x24, 0x89, 0xf1, 0xbb, 0x3d, 0x10, 0x29, 0x14, 0x8e, 0x0d, 0x83, 0x0b, 0x5a, 0x13, 0x99, 0xda, 0xff, 0x10, 0x84, 0x04, 0x8e, 0x7b, 0xd8, 0xdb, 0xe9, 0xf8, 0x59,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01,
            // SPL Associate Token Account -- Create
            0x06,
            0x07,
                0x00, 0x01, 0x00, 0x02, 0x03, 0x04, 0x05,
            0x00,
    };
    process_message_body_and_sanity_check(message, sizeof(message), 5);
}

void test_process_message_body_spl_associated_token_create_with_transfer() {
    uint8_t message[] = {
        0x02, 0x00, 0x05,
        0x09,
            0x0a, 0xc5, 0x47, 0xa6, 0x54, 0x8f, 0xee, 0x6a, 0x3c, 0x47, 0xd2, 0x8c, 0x32, 0x2e, 0x05, 0x40, 0xc5, 0xe9, 0xb8, 0xb9, 0xf0, 0x01, 0xbd, 0x3c, 0x55, 0xd0, 0xff, 0xff, 0x17, 0xc1, 0x80, 0xde,
            0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x1d, 0x30, 0x63, 0xde, 0x69, 0x0b, 0xcd, 0xbe, 0x38, 0xec, 0x74, 0x44, 0x99, 0x23, 0x20, 0x25, 0xc1, 0xad, 0x64, 0x92, 0x6e, 0xd5, 0x6c, 0x69, 0xa5, 0xe3, 0x10, 0x34, 0x41, 0x19, 0xcb, 0x57,
            0x48, 0xc9, 0xf2, 0x50, 0xac, 0xb4, 0xe8, 0xfe, 0x45, 0x0a, 0x51, 0xe1, 0x9d, 0x74, 0x9a, 0xee, 0x98, 0x66, 0x51, 0x19, 0x55, 0x43, 0xb4, 0xe6, 0x0d, 0x52, 0x26, 0x61, 0xed, 0x62, 0x71, 0x26,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x06, 0xdd, 0xf6, 0xe1, 0xd7, 0x65, 0xa1, 0x93, 0xd9, 0xcb, 0xe1, 0x46, 0xce, 0xeb, 0x79, 0xac, 0x1c, 0xb4, 0x85, 0xed, 0x5f, 0x5b, 0x37, 0x91, 0x3a, 0x8c, 0xf5, 0x85, 0x7e, 0xff, 0x00, 0xa9,
            0x06, 0xa7, 0xd5, 0x17, 0x19, 0x2c, 0x5c, 0x51, 0x21, 0x8c, 0xc9, 0x4c, 0x3d, 0x4a, 0xf1, 0x7f, 0x58, 0xda, 0xee, 0x08, 0x9b, 0xa1, 0xfd, 0x44, 0xe3, 0xdb, 0xd9, 0x8a, 0x00, 0x00, 0x00, 0x00,
            0x8c, 0x97, 0x25, 0x8f, 0x4e, 0x24, 0x89, 0xf1, 0xbb, 0x3d, 0x10, 0x29, 0x14, 0x8e, 0x0d, 0x83, 0x0b, 0x5a, 0x13, 0x99, 0xda, 0xff, 0x10, 0x84, 0x04, 0x8e, 0x7b, 0xd8, 0xdb, 0xe9, 0xf8, 0x59,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x02,
            0x08,
            0x07,
                0x01, 0x02, 0x00, 0x04, 0x05, 0x06, 0x07,
            0x00,

            0x06,
            0x04,
                0x02, 0x04, 0x03, 0x00,
            0x0a,
                0x0c,
                0x2a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x09
    };
    process_message_body_and_sanity_check(message, sizeof(message), 11);
}

void test_process_message_body_spl_associated_token_create_with_transfer_and_assert_owner() {
    uint8_t message[] = {
            0x01, 0x00, 0x07,
            0x0a,
                0x0a, 0xc5, 0x47, 0xa6, 0x54, 0x8f, 0xee, 0x6a, 0x3c, 0x47, 0xd2, 0x8c, 0x32, 0x2e, 0x05, 0x40, 0xc5, 0xe9, 0xb8, 0xb9, 0xf0, 0x01, 0xbd, 0x3c, 0x55, 0xd0, 0xff, 0xff, 0x17, 0xc1, 0x80, 0xde,
                0x48, 0xc9, 0xf2, 0x50, 0xac, 0xb4, 0xe8, 0xfe, 0x45, 0x0a, 0x51, 0xe1, 0x9d, 0x74, 0x9a, 0xee, 0x98, 0x66, 0x51, 0x19, 0x55, 0x43, 0xb4, 0xe6, 0x0d, 0x52, 0x26, 0x61, 0xed, 0x62, 0x71, 0x26,
                0x1d, 0x30, 0x63, 0xde, 0x69, 0x0b, 0xcd, 0xbe, 0x38, 0xec, 0x74, 0x44, 0x99, 0x23, 0x20, 0x25, 0xc1, 0xad, 0x64, 0x92, 0x6e, 0xd5, 0x6c, 0x69, 0xa5, 0xe3, 0x10, 0x34, 0x41, 0x19, 0xcb, 0x57,
                0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x06, 0xdd, 0xf6, 0xe1, 0xd7, 0x65, 0xa1, 0x93, 0xd9, 0xcb, 0xe1, 0x46, 0xce, 0xeb, 0x79, 0xac, 0x1c, 0xb4, 0x85, 0xed, 0x5f, 0x5b, 0x37, 0x91, 0x3a, 0x8c, 0xf5, 0x85, 0x7e, 0xff, 0x00, 0xa9,
                0x06, 0xa7, 0xd5, 0x17, 0x19, 0x2c, 0x5c, 0x51, 0x21, 0x8c, 0xc9, 0x4c, 0x3d, 0x4a, 0xf1, 0x7f, 0x58, 0xda, 0xee, 0x08, 0x9b, 0xa1, 0xfd, 0x44, 0xe3, 0xdb, 0xd9, 0x8a, 0x00, 0x00, 0x00, 0x00,
                0x31, 0xca, 0xdc, 0xe2, 0xaa, 0x36, 0xec, 0x04, 0x60, 0x46, 0x83, 0xea, 0xa6, 0xf1, 0x36, 0x2c, 0x32, 0x9e, 0x11, 0x91, 0x04, 0x28, 0x42, 0xa0, 0x4e, 0x09, 0xb8, 0x2b, 0x75, 0x9f, 0xb3, 0x24,
                0x8c, 0x97, 0x25, 0x8f, 0x4e, 0x24, 0x89, 0xf1, 0xbb, 0x3d, 0x10, 0x29, 0x14, 0x8e, 0x0d, 0x83, 0x0b, 0x5a, 0x13, 0x99, 0xda, 0xff, 0x10, 0x84, 0x04, 0x8e, 0x7b, 0xd8, 0xdb, 0xe9, 0xf8, 0x59,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x03,
                // Serum Assert Owner check
                0x08,
                0x01,
                    0x03,
                0x20,
                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                // SPL ATA create
                0x09,
                0x07,
                    0x00, 0x01, 0x03, 0x04, 0x05, 0x06, 0x07,
                0x00,
                // SPL Token transfer checked
                0x06,
                0x04,
                    0x02, 0x04, 0x01, 0x00,
                0x0a,
                    0x0c,
                    0x2a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                    0x09
    };
    process_message_body_and_sanity_check(message, sizeof(message), 11);
}

/* clang-format on */

int main() {
    test_process_message_body_spl_associated_token_create_with_transfer_and_assert_owner();
    test_process_message_body_spl_associated_token_create_with_transfer();
    test_process_message_body_spl_associated_token_create();
    test_process_message_body_spl_token_create_token();
    test_process_message_body_spl_token_create_account();
    test_process_message_body_spl_token_create_account2();
    test_process_message_body_spl_token_create_multisig();
    test_process_message_body_spl_token_transfer();
    test_process_message_body_spl_token_approve();
    test_process_message_body_spl_token_revoke();
    test_process_message_body_spl_token_set_authority();
    test_process_message_body_spl_token_mint_to();
    test_process_message_body_spl_token_burn();
    test_process_message_body_spl_token_close_account();
    test_process_message_body_spl_token_freeze_account();
    test_process_message_body_spl_token_thaw_account();
    test_process_message_body_ok();
    test_process_message_body_too_few_ix_fail();
    test_process_message_body_too_many_ix_fail();
    test_process_message_body_data_too_short_fail();
    test_process_message_body_data_too_long_fail();
    test_process_message_body_bad_ix_account_index_fail();
    test_process_message_body_unknown_ix_enum_fail();
    test_process_message_body_ix_with_unknown_program_id_fail();
    test_process_message_body_xfer_w_nonce_ok();
    test_process_message_body_nonced_stake_create_with_seed();
    test_process_message_body_create_stake_account();
    test_process_message_body_create_stake_account_no_lockup();
    test_process_message_body_nonced_stake_create_with_seed_checked();
    test_process_message_body_create_stake_account_checked();
    test_process_message_body_create_nonce_account_with_seed();
    test_process_message_body_create_nonce_account();
    test_process_message_body_create_vote_account_with_seed();
    test_process_message_body_create_vote_account();
    test_process_message_body_nonce_withdraw();
    test_process_message_body_stake_withdraw();
    test_process_message_body_vote_withdraw();
    test_process_message_body_system_nonce_authorize();
    test_process_message_body_stake_authorize_staker();
    test_process_message_body_stake_authorize_withdrawer();
    test_process_message_body_stake_authorize_withdrawer_with_custodian();
    test_process_message_body_stake_authorize_both();
    test_process_message_body_stake_authorize_staker_checked();
    test_process_message_body_stake_authorize_withdrawer_checked();
    test_process_message_body_stake_authorize_withdrawer_with_custodian_checked();
    test_process_message_body_stake_authorize_both_checked();
    test_process_message_body_vote_authorize_voter();
    test_process_message_body_vote_authorize_withdrawer();
    test_process_message_body_vote_authorize_both();
    test_process_message_body_vote_authorize_voter_checked();
    test_process_message_body_vote_authorize_withdrawer_checked();
    test_process_message_body_vote_authorize_both_checked();
    test_process_message_body_vote_update_commission();
    test_process_message_body_vote_update_node_v1_0_7();
    test_process_message_body_vote_update_node_v1_0_8();
    test_process_message_body_stake_delegate();
    test_process_message_body_stake_delegate_with_nonce();
    test_process_message_body_create_stake_account_and_delegate();
    test_process_message_body_create_stake_with_seed_account_and_delegate();
    test_process_message_body_stake_deactivate();
    test_process_message_body_stake_set_lockup();
    test_process_message_body_stake_set_lockup_checked();
    test_process_message_body_stake_split_with_nonce_v1_1();
    test_process_message_body_stake_split_with_nonce_v1_2();
    test_process_message_body_stake_split_with_seed_v1_1();
    test_process_message_body_stake_split_with_seed_v1_2();
    test_process_message_body_stake_merge();
    test_process_message_body_transfer_with_compute_budget_limit();
    test_process_message_body_transfer_with_compute_budget_limit_and_unit_price();
    test_process_message_body_transfer_with_request_units();
    test_process_message_body_transfer_with_heap_frame();

    printf("passed\n");
    return 0;
}
