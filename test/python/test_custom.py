import pytest

from ragger.utils import RAPDU, prefix_with_len, create_currency_config
from ragger.error import ExceptionRAPDU

from .apps.exchange import ExchangeClient, Rate, SubCommand, Errors, Command, P2_EXTEND, P2_MORE, EXCHANGE_CLASS
from .apps.exchange_transaction_builder import get_partner_curve, LEGACY_SUBCOMMANDS, ALL_SUBCOMMANDS, NEW_SUBCOMMANDS, get_credentials, craft_and_sign_tx
from .apps.signing_authority import SigningAuthority, LEDGER_SIGNER
from .apps import cal as cal

def test_custom(backend):
    backend.exchange_raw(bytes.fromhex("e003000300"))
    backend.exchange_raw(bytes.fromhex("e0040003500d544553542d50524f5649444552000478d5facdae2305f48795d3ce7d9244f5060d2f800901da5746d1f4177ae8d7bbe63f3870efc0d36af8f91962811e1d8d9df91ce3b3ea2cd9f550c7d465f8b7b3"))
    backend.exchange_raw(bytes.fromhex("e0050003483046022100ddff28e84aaee65238bfbd095e2be47597d76c0cfb1ae637cb2f6b3e6658994c022100d899d82d4855e92a9f1c34866edb2ae34603f9735ef9dfa6caf7a18d5ba4c260"))
    backend.exchange_raw(bytes.fromhex("e0060023ff010104436978494e6d566a6147685952476c535a6b4e7155326433656a5657546d6c474e326379646b705a56445233527a6c365a7a64305557644c5757467a52426f734e6d67794d546855634664475348427059576f3255475a6c4f47633555587033636d4a475255784f56564e5a636d464f51576c56615646744d5534714b6a42344e6a5a6a4e444d334d5746464f455a475a5551795a574d78597a4a46516d4a6959304e6d596a64464e446b304d546778525446464d7a6f4556564e45513049445256524953674b635146494831536d756e6f5941414749674e517271444a6633525f4851393243425268536b64534f41477872726651764c75714b6b"))
    backend.exchange_raw(bytes.fromhex("e00600130b394776344745733d021388"))
    backend.exchange_raw(bytes.fromhex("e0070003420101aabd14e125712a6384b6b40f3a66b847764cf6f536b175f2cf8de7a53792cc67130fede99a2a07825af109bcfee6e449702c5f9b279ef6611c05f2a702bacfad"))
    # backend.exchange_raw(bytes.fromhex("b0060400a001010102010235010536010110040105000013020002140101200c747275737465645f6e616d65300200073101043201213401013321036a94e7a42cd0c33fdf440c8e2ab2542cefbe5db7aa0b93a9fc814b9acfa75eb415473045022100a9a018f7a1e66dd0d511aafe115741fadaae892cb2cb37158ff33ee01a10128602204d0a2ef7ca5516e84decf08928508e730a0597546a821a81475ffb5325713d17"))
    backend.exchange_raw(bytes.fromhex("e010000300"))
    backend.exchange_raw(bytes.fromhex("e0110003ee010103020102700106710106202c366832313854705746487069616a36506665386739517a77726246454c4e55535972614e41695569516d314e230165222c36334d376b504a764c734734366a6252325a7269455538787750716b4d4e4b4e6f4242513436706f6262766f732c45506a465764643541756671535371654d32714e31787a7962617043384734774547476b5a777954447431761204c109b22c13010714010115473045022100852992b200393e61db3c7f6cd6ce8bc4754fe88ec7377caf3736eaf54ef8624502205cfaa5d4762b575b8f2985a8cdf43ba04a9d9482d2081243af310e636d4a9bec"))
    backend.exchange_raw(bytes.fromhex("e0080003781b0345544808457468657265756d0d034554481200000000000000013044022012a5debd11d33370106b59a0c71ac27c6337f48ba5d6d34d5933657a8a7f9af0022002dfcdeee3edcc380d3389bca60afec114dc9b3b274ab28058c5714d5946a6ec15058000002c8000003c800000000000000000000000"))
    backend.exchange_raw(bytes.fromhex("e00900036813045553444306536f6c616e61060455534443063044022025169f3f8ede05c55735b3a067753c4763e54161e80f31155cce7e6edf34fda202201458433d08c9b8c065d5f0b4bb83d6bdbff4caadc04a4836462573782ec6471c0d038000002c800001f580000001"))
    backend.exchange_raw(bytes.fromhex("e00a000300"))
    backend.exchange_raw(bytes.fromhex("e0040003500d544553542d50524f5649444552000478d5facdae2305f48795d3ce7d9244f5060d2f800901da5746d1f4177ae8d7bbe63f3870efc0d36af8f91962811e1d8d9df91ce3b3ea2cd9f550c7d465f8b7b3"))
    backend.exchange_raw(bytes.fromhex("e0050003483046022100ddff28e84aaee65238bfbd095e2be47597d76c0cfb1ae637cb2f6b3e6658994c022100d899d82d4855e92a9f1c34866edb2ae34603f9735ef9dfa6caf7a18d5ba4c260"))
    backend.exchange_raw(bytes.fromhex("e0060023ff010104436978494e6d566a6147685952476c535a6b4e7155326433656a5657546d6c474e326379646b705a56445233527a6c365a7a64305557644c5757467a52426f734e6d67794d546855634664475348427059576f3255475a6c4f47633555587033636d4a475255784f56564e5a636d464f51576c56615646744d5534714b6a42344e6a5a6a4e444d334d5746464f455a475a5551795a574d78597a4a46516d4a6959304e6d596a64464e446b304d546778525446464d7a6f4556564e45513049445256524953674b635146494831536d756e6f5941414749674e517271444a6633525f4851393243425268536b64534f41477872726651764c75714b6b"))


# => e003000300
# <= 350aea0c97f747f1d0f760814614a47523801b1aeb7d0bcbbaa2a4f46bf8184b9000
# => e0040003500d544553542d50524f5649444552000478d5facdae2305f48795d3ce7d9244f5060d2f800901da5746d1f4177ae8d7bbe63f3870efc0d36af8f91962811e1d8d9df91ce3b3ea2cd9f550c7d465f8b7b3
# <= 9000
# => e0050003483046022100ddff28e84aaee65238bfbd095e2be47597d76c0cfb1ae637cb2f6b3e6658994c022100d899d82d4855e92a9f1c34866edb2ae34603f9735ef9dfa6caf7a18d5ba4c260
# <= 9000
# => e0060023ff010104436978494e6d566a6147685952476c535a6b4e7155326433656a5657546d6c474e326379646b705a56445233527a6c365a7a64305557644c5757467a52426f734e6d67794d546855634664475348427059576f3255475a6c4f47633555587033636d4a475255784f56564e5a636d464f51576c56615646744d5534714b6a42344e6a5a6a4e444d334d5746464f455a475a5551795a574d78597a4a46516d4a6959304e6d596a64464e446b304d546778525446464d7a6f4556564e45513049445256524953674b635146494831536d756e6f5941414749674e517271444a6633525f4851393243425268536b64534f41477872726651764c75714b6b
# <= 9000
# => e00600130b394776344745733d021388
# <= 9000
# => e0070003420101aabd14e125712a6384b6b40f3a66b847764cf6f536b175f2cf8de7a53792cc67130fede99a2a07825af109bcfee6e449702c5f9b279ef6611c05f2a702bacfad
# <= 9000
# => b0060400a001010102010235010536010110040105000013020002140101200c747275737465645f6e616d65300200073101043201213401013321036a94e7a42cd0c33fdf440c8e2ab2542cefbe5db7aa0b93a9fc814b9acfa75eb415473045022100a9a018f7a1e66dd0d511aafe115741fadaae892cb2cb37158ff33ee01a10128602204d0a2ef7ca5516e84decf08928508e730a0597546a821a81475ffb5325713d17
# <= 9000
# => e010000300
# <= c109b22c9000
# => e0110003ee010103020102700106710106202c366832313854705746487069616a36506665386739517a77726246454c4e55535972614e41695569516d314e230165222c36334d376b504a764c734734366a6252325a7269455538787750716b4d4e4b4e6f4242513436706f6262766f732c45506a465764643541756671535371654d32714e31787a7962617043384734774547476b5a777954447431761204c109b22c13010714010115473045022100852992b200393e61db3c7f6cd6ce8bc4754fe88ec7377caf3736eaf54ef8624502205cfaa5d4762b575b8f2985a8cdf43ba04a9d9482d2081243af310e636d4a9bec
# <= 9000
# => e0080003781b0345544808457468657265756d0d034554481200000000000000013044022012a5debd11d33370106b59a0c71ac27c6337f48ba5d6d34d5933657a8a7f9af0022002dfcdeee3edcc380d3389bca60afec114dc9b3b274ab28058c5714d5946a6ec15058000002c8000003c800000000000000000000000
# <= 9000
# => e00900036813045553444306536f6c616e61060455534443063044022025169f3f8ede05c55735b3a067753c4763e54161e80f31155cce7e6edf34fda202201458433d08c9b8c065d5f0b4bb83d6bdbff4caadc04a4836462573782ec6471c0d038000002c800001f580000001
# <= 9000
# => e00a000300
# <= 9000
# => e0040003500d544553542d50524f5649444552000478d5facdae2305f48795d3ce7d9244f5060d2f800901da5746d1f4177ae8d7bbe63f3870efc0d36af8f91962811e1d8d9df91ce3b3ea2cd9f550c7d465f8b7b3
# <= 00000107009000
# => e0050003483046022100ddff28e84aaee65238bfbd095e2be47597d76c0cfb1ae637cb2f6b3e6658994c022100d899d82d4855e92a9f1c34866edb2ae34603f9735ef9dfa6caf7a18d5ba4c260
# <= 9000
# => e0060023ff010104436978494e6d566a6147685952476c535a6b4e7155326433656a5657546d6c474e326379646b705a56445233527a6c365a7a64305557644c5757467a52426f734e6d67794d546855634664475348427059576f3255475a6c4f47633555587033636d4a475255784f56564e5a636d464f51576c56615646744d5534714b6a42344e6a5a6a4e444d334d5746464f455a475a5551795a574d78597a4a46516d4a6959304e6d596a64464e446b304d546778525446464d7a6f4556564e45513049445256524953674b635146494831536d756e6f5941414749674e517271444a6633525f4851393243425268536b64534f41477872726651764c75714b6b
# <= 6a80
